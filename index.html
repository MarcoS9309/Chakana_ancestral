<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Chakana | Mapa interactivo (Ancestralidad ‚Üî Innovaci√≥n)</title>
  <meta name="description" content="Reinterpretaci√≥n interactiva de la Chakana andina: capas sem√°nticas, niveles y su di√°logo con la innovaci√≥n. P√°gina est√°tica en HTML, CSS y JS." />
  <style>
    :root{
      /* Paleta ancestral inspirada en textiles andinos y la naturaleza */
      --bg-primary: #2d1810; /* Tierra oscura */
      --bg-secondary: #3a2317; /* Arcilla */
      --bg-panel: #4a2d1f; /* Terracota */
      --text-primary: #f5f1eb; /* Crema claro */
      --text-secondary: #e0d5c7; /* Crema */
      --text-muted: #b8a691; /* Beige apagado */
      
      /* Colores simb√≥licos andinos */
      --color-oro: #d4af37; /* Oro del sol */
      --color-plata: #c0c0c0; /* Plata de la luna */
      --color-cobre: #b87333; /* Cobre de las monta√±as */
      --color-turquesa: #40e0d0; /* Turquesa sagrada */
      --color-cochinilla: #dc143c; /* Rojo cochinilla */
      --color-inti: #ff6b35; /* Naranja del Inti */
      --color-pachamama: #8b4513; /* Marr√≥n de la Pachamama */
      
      /* Modo ancestral */
      --accent: var(--color-oro);
      --accent-secondary: var(--color-cobre);
      
      /* Sombras y efectos */
      --shadow-soft: 0 8px 32px rgba(45, 24, 16, 0.3);
      --shadow-strong: 0 16px 48px rgba(45, 24, 16, 0.5);
      --gradient-chakana: linear-gradient(135deg, var(--color-oro), var(--color-cobre), var(--color-inti));
    }

    [data-mode="innovacion"]{
      --accent: var(--color-turquesa);
      --accent-secondary: var(--color-plata);
    }

    html,body{height:100%}
    body{
      margin:0; 
      background: radial-gradient(ellipse at center top, #4a2d1f 0%, #3a2317 35%, #2d1810 70%, #1a0f08 100%);
      color: var(--text-primary); 
      font-family: 'Georgia', 'Times New Roman', serif;
      font-size: 16px;
      line-height: 1.6;
      letter-spacing: 0.3px;
    }
    .wrap{max-width: 1200px; margin: 0 auto; padding: 32px 24px;}

    header{
      display:flex; align-items:center; justify-content:space-between; gap:20px; 
      margin-bottom:32px; padding-bottom: 24px;
      border-bottom: 2px solid var(--color-cobre);
    }
    .brand{display:flex; align-items:center; gap:16px}
    .logo{
      width:48px;height:48px;border-radius:12px; 
      background: var(--gradient-chakana);
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    .logo::before{
      content: '';
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: 24px; height: 24px;
      background: var(--text-primary);
      clip-path: polygon(40% 0%, 60% 0%, 60% 40%, 100% 40%, 100% 60%, 60% 60%, 60% 100%, 40% 100%, 40% 60%, 0% 60%, 0% 40%, 40% 40%);
    }
    h1{
      font-size: clamp(20px, 4vw, 32px); 
      margin:0; 
      color: var(--color-oro);
      font-weight: 600;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
    }
    .subtitle{
      color: var(--text-secondary); 
      font-size: 14px;
      font-style: italic;
    }

    .toolbar{display:flex; gap:16px; align-items:center}
    .btn{
      appearance:none; 
      border:2px solid var(--accent-secondary); 
      background: linear-gradient(145deg, var(--bg-panel), var(--bg-secondary));
      color: var(--text-primary);
      padding:12px 20px; 
      border-radius:16px; 
      cursor:pointer; 
      box-shadow: var(--shadow-soft);
      transition: all 0.3s ease;
      font-weight:600; 
      letter-spacing:0.5px;
      font-family: inherit;
    }
    .btn:hover{
      transform: translateY(-2px); 
      background: linear-gradient(145deg, var(--accent-secondary), var(--accent));
      border-color: var(--accent);
      color: var(--text-primary);
      box-shadow: var(--shadow-strong);
    }
    .btn:active{transform: translateY(0)}

    .main-layout{
      display:grid; 
      grid-template-columns: 1fr 600px; 
      gap:32px;
      margin-bottom: 32px;
    }
    @media (max-width: 1000px){ 
      .main-layout{grid-template-columns:1fr;}
    }

    .card{
      background: linear-gradient(145deg, var(--bg-panel), var(--bg-secondary)); 
      border: 2px solid var(--color-cobre); 
      border-radius:24px; 
      padding:24px; 
      box-shadow: var(--shadow-soft);
      position: relative;
      overflow: hidden;
    }
    .card::before{
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 4px;
      background: var(--gradient-chakana);
    }
    .card h2{
      font-size: clamp(18px, 3vw, 24px); 
      margin: 0 0 16px; 
      color: var(--accent);
      font-weight: 600;
    }
    .card h3{
      font-size: 16px; 
      margin: 16px 0 8px; 
      color: var(--text-secondary);
      font-weight: 500;
    }

    .meta{display:flex; flex-wrap:wrap; gap:12px; margin:16px 0 20px}
    .chip{
      font-size:12px; 
      padding:8px 14px; 
      border-radius:20px; 
      border:1px solid var(--color-cobre); 
      background: rgba(212, 175, 55, 0.1); 
      color: var(--text-secondary);
      font-weight: 500;
    }

    .info p{margin:12px 0; line-height: 1.7}
    .info ul{margin:12px 0 20px 24px; line-height: 1.7}
    .info li{margin-bottom: 8px}

    .svg-wrap{
      display:grid; 
      place-items:center;
      padding: 20px;
      background: radial-gradient(circle at center, rgba(212, 175, 55, 0.05), transparent 70%);
      border-radius: 20px;
    }
    svg{max-width: 500px; width: 100%; height: auto; display:block}

    /* Chakana aut√©ntica inspirada en dise√±os andinos */
    .chakana-base{
      fill: url(#gradChakana); 
      stroke: var(--color-oro); 
      stroke-width: 3;
      filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
    }
    .chakana-steps{
      fill: var(--color-cobre); 
      stroke: var(--color-oro); 
      stroke-width: 1.5;
      opacity: 0.8;
    }
    .region-interactive{
      fill: transparent; 
      cursor: pointer;
      transition: all 0.3s ease;
    }
    .region-interactive:hover{
      fill: rgba(212, 175, 55, 0.2);
      stroke: var(--color-oro);
      stroke-width: 2;
    }
    .center-disc{
      fill: var(--gradient-chakana); 
      stroke: var(--color-oro); 
      stroke-width: 3;
      filter: drop-shadow(0 2px 4px rgba(0,0,0,0.4));
      transition: all 0.3s ease;
    }
    .center-disc:hover{
      transform: scale(1.05);
    }

    .active-region{
      fill: rgba(212, 175, 55, 0.3) !important;
      stroke: var(--color-oro) !important;
      stroke-width: 3 !important;
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0% { opacity: 0.7; }
      50% { opacity: 1; }
      100% { opacity: 0.7; }
    }

    .label{
      font-family: 'Georgia', serif;
      font-size: 14px;
      font-weight: 600;
      fill: var(--text-primary); 
      text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
      transition: all 0.3s ease;
    }
    .label.highlight{
      fill: var(--color-oro);
      font-size: 16px;
    }

    .legend{display:flex; flex-wrap:wrap; gap:12px; margin-top: 20px}
    .legend .pill{
      font-size:13px; 
      border:2px solid var(--color-cobre); 
      padding:10px 16px; 
      border-radius:25px; 
      cursor:pointer; 
      color: var(--text-secondary);
      background: rgba(212, 175, 55, 0.05);
      transition: all 0.3s ease;
      font-weight: 500;
    }
    .legend .pill:hover{
      background: rgba(212, 175, 55, 0.15);
      border-color: var(--color-oro);
      color: var(--text-primary);
    }
    .legend .pill.active{
      border-color: var(--color-oro); 
      color: var(--text-primary); 
      background: rgba(212, 175, 55, 0.25);
      box-shadow: 0 0 12px rgba(212, 175, 55, 0.3);
    }

    /* Timeline hist√≥rico */
    .timeline{
      margin-top: 32px;
      padding: 24px;
      background: linear-gradient(145deg, var(--bg-panel), var(--bg-secondary));
      border: 2px solid var(--color-cobre);
      border-radius: 24px;
      position: relative;
    }
    .timeline::before{
      content: '';
      position: absolute;
      top: 0; left: 0;
      width: 100%; height: 4px;
      background: var(--gradient-chakana);
    }
    .timeline h2{
      color: var(--color-oro);
      margin-bottom: 24px;
      font-size: 24px;
    }
    .timeline-items{
      display: grid;
      gap: 20px;
    }
    .timeline-item{
      padding: 16px 20px;
      background: rgba(212, 175, 55, 0.08);
      border-left: 4px solid var(--color-oro);
      border-radius: 8px;
      transition: all 0.3s ease;
    }
    .timeline-item:hover{
      background: rgba(212, 175, 55, 0.15);
      transform: translateX(8px);
    }
    .timeline-year{
      font-weight: bold;
      color: var(--color-oro);
      font-size: 18px;
      margin-bottom: 8px;
    }
    .timeline-desc{
      color: var(--text-secondary);
      line-height: 1.6;
    }

    footer{
      margin-top:32px; 
      padding-top: 24px;
      border-top: 2px solid var(--color-cobre);
      color: var(--text-muted); 
      font-size:14px; 
      line-height: 1.6;
    }
    a{color:var(--accent); text-decoration:none; transition: color 0.3s ease}
    a:hover{text-decoration:underline; color: var(--color-oro)}

    /* Accesibilidad: foco visible en regiones */
    .region-interactive:focus{outline:none; stroke: var(--color-oro); stroke-width: 3; fill: rgba(212,175,55,.18)}

    /* Tooltip flotante */
    .tooltip{
      position: fixed; pointer-events: none; z-index: 1000; 
      background: rgba(20,12,6,.95);
      color: var(--text-primary);
      border: 1px solid var(--color-cobre);
      border-radius: 10px;
      padding: 10px 12px;
      box-shadow: var(--shadow-strong);
      max-width: 280px;
      font-size: 13px;
      line-height: 1.5;
      transform: translate(-50%, -120%);
      opacity: 0; transition: opacity .2s ease;
    }
    .tooltip.visible{opacity:1}
    .tooltip .t-title{font-weight:700; color: var(--color-oro); margin-bottom: 4px}
    .tooltip .t-desc{color: var(--text-secondary)}

    /* Toast de notificaci√≥n */
    .toast{position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%);
      background: rgba(20,12,6,.95); border:1px solid var(--color-cobre); color: var(--text-primary);
      padding: 10px 14px; border-radius: 12px; box-shadow: var(--shadow-strong);
      z-index: 1100; opacity: 0; transition: opacity .25s ease}
    .toast.show{opacity:1}

    /* Modal de ayuda */
    .modal-backdrop{position: fixed; inset: 0; background: rgba(0,0,0,.6); display:none; z-index: 1200}
    .modal{position: fixed; inset: 0; display:none; place-items: center; z-index: 1201}
    .modal .box{background: linear-gradient(145deg, var(--bg-panel), var(--bg-secondary)); border:2px solid var(--color-cobre);
      border-radius: 16px; max-width: 680px; width: calc(100% - 40px); padding: 20px; color: var(--text-primary); box-shadow: var(--shadow-strong)}
    .modal .box h3{margin:0 0 10px; color: var(--color-oro)}
    .modal .box p{margin: 8px 0; color: var(--text-secondary)}
    .modal .actions{display:flex; justify-content:flex-end; margin-top: 12px}
    .modal .actions .btn{border-color: var(--color-oro)}
  </style>
</head>
<body data-mode="ancestral">
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true"></div>
        <div>
          <h1>Chakana Ancestral</h1>
          <div class="subtitle">Sabidur√≠a andina ¬∑ S√≠mbolo de equilibrio y reciprocidad</div>
        </div>
      </div>
      <div class="toolbar">
  <button id="modeBtn" class="btn" aria-pressed="false" title="Cambiar modo (Ancestralidad/Innovaci√≥n)">Modo: <span id="modeLabel">Ancestralidad</span></button>
  <button id="tourBtn" class="btn" aria-pressed="false" title="Iniciar recorrido autom√°tico">Recorrido</button>
  <button id="copyBtn" class="btn" title="Copiar enlace del estado actual">Copiar estado</button>
  <button id="helpBtn" class="btn" title="Ver ayuda e instrucciones">Ayuda</button>
      </div>
    </header>

    <section class="main-layout">
      <article class="card info" id="info">
        <h2 id="info-title">Centro ¬∑ Axis mundi</h2>
        <div class="meta">
          <span class="chip" id="modeTag">Capa: Ancestral</span>
          <span class="chip">Interactivo</span>
          <span class="chip">Educativo</span>
        </div>
        <p id="info-summary">N√∫cleo articulador del cosmos simb√≥lico andino: punto de cruce y equilibrio. En esta lectura, representa el v√≠nculo entre niveles (Hanan, Kay, Ukhu) y las cuatro direcciones sagradas.</p>
        <h3>Significado Profundo</h3>
        <ul id="info-bullets">
          <li>Equilibrio de opuestos y complementariedad (ayni).</li>
          <li>Articulaci√≥n temporal-espacial del rito y el trabajo.</li>
          <li>Referencia para orientarse en el territorio y la comunidad.</li>
        </ul>
        <div class="legend" role="group" aria-label="Capas visuales">
          <button class="pill active" data-layer="dirs" aria-pressed="true">Direcciones</button>
          <button class="pill" data-layer="niveles" aria-pressed="false">Tres Mundos</button>
          <button class="pill" data-layer="suyus" aria-pressed="false">Tawantinsuyu</button>
        </div>
      </article>

  <aside class="card svg-wrap">
        <svg id="chakana" viewBox="0 0 500 500" role="img" aria-labelledby="svgTitle svgDesc">
          <title id="svgTitle">Chakana - Cruz Andina Sagrada</title>
          <desc id="svgDesc">Representaci√≥n interactiva de la Chakana, s√≠mbolo sagrado andino con centro y cuatro direcciones, mostrando los tres mundos y las cuatro regiones del Tawantinsuyu.</desc>

          <!-- Definiciones de gradientes -->
          <defs>
            <linearGradient id="gradChakana" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#d4af37"/>
              <stop offset="50%" stop-color="#b87333"/>
              <stop offset="100%" stop-color="#ff6b35"/>
            </linearGradient>
            <radialGradient id="gradCenter" cx="50%" cy="50%" r="50%">
              <stop offset="0%" stop-color="#d4af37"/>
              <stop offset="100%" stop-color="#b87333"/>
            </radialGradient>
          </defs>

          <!-- Cruz escalonada principal (dise√±o m√°s aut√©ntico) -->
          <path class="chakana-base" d="M180 60 H320 L340 80 V180 H440 L460 200 V300 L440 320 H340 V420 L320 440 H180 L160 420 V320 H60 L40 300 V200 L60 180 H160 V80 Z"/>
          
          <!-- Escalones internos para darle profundidad -->
          <path class="chakana-steps" d="M200 100 H300 V200 H400 V300 H300 V400 H200 V300 H100 V200 H200 Z"/>

          <!-- Disco central sagrado -->
          <circle id="r-centro" class="center-disc region-interactive" cx="250" cy="250" r="50" tabindex="0" data-key="centro" aria-label="Centro ¬∑ Axis Mundi"/>

          <!-- Regiones interactivas (brazos de la chakana) -->
          <rect id="r-norte" class="region-interactive" x="190" y="60" width="120" height="140" tabindex="0" data-key="norte" rx="10" aria-label="Norte ¬∑ Hanan"/>
          <rect id="r-sur"   class="region-interactive" x="190" y="300" width="120" height="140" tabindex="0" data-key="sur" rx="10" aria-label="Sur ¬∑ Ukhu"/>
          <rect id="r-este"  class="region-interactive" x="300" y="190" width="160" height="120" tabindex="0" data-key="este" rx="10" aria-label="Este ¬∑ Antisuyu"/>
          <rect id="r-oeste" class="region-interactive" x="40"  y="190" width="160" height="120" tabindex="0" data-key="oeste" rx="10" aria-label="Oeste ¬∑ Kuntisuyu"/>

          <!-- Capas din√°micas (etiquetas informativas) -->
          <g id="layer-dirs" opacity="1">
            <text class="label" x="250" y="90" text-anchor="middle">Norte</text>
            <text class="label" x="410" y="255" text-anchor="middle">Este</text>
            <text class="label" x="250" y="425" text-anchor="middle">Sur</text>
            <text class="label" x="90"  y="255" text-anchor="middle">Oeste</text>
          </g>
          <g id="layer-niveles" opacity="0">
            <text class="label" x="250" y="120" text-anchor="middle">Hanan Pacha</text>
            <text class="label" x="250" y="260" text-anchor="middle">Kay Pacha</text>
            <text class="label" x="250" y="400" text-anchor="middle">Ukhu Pacha</text>
          </g>
          <g id="layer-suyus" opacity="0">
            <text class="label" x="370" y="140">Antisuyu</text>
            <text class="label" x="110" y="140">Chinchaysuyu</text>
            <text class="label" x="370" y="380">Qullasuyu</text>
            <text class="label" x="110" y="380">Kuntisuyu</text>
          </g>
        </svg>
      </aside>
    </section>

    <!-- Timeline Hist√≥rico -->
    <section class="timeline">
      <h2>üìú Timeline Hist√≥rico de la Chakana</h2>
      <div class="timeline-items">
        <div class="timeline-item">
          <div class="timeline-year">3000 - 1000 a.C.</div>
          <div class="timeline-desc">
            <strong>Or√≠genes Preincaicos:</strong> Los primeros s√≠mbolos escalonados aparecen en culturas como Chav√≠n y Wari. 
            La cruz escalonada representa la conexi√≥n entre los mundos y las direcciones sagradas.
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-year">1200 - 1532 d.C.</div>
          <div class="timeline-desc">
            <strong>Imperio Incaico:</strong> La Chakana se consolida como s√≠mbolo central del Tawantinsuyu. 
            Representa la organizaci√≥n del imperio en cuatro regiones (suyus) y los tres mundos andinos.
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-year">1532 - 1780 d.C.</div>
          <div class="timeline-desc">
            <strong>√âpoca Colonial:</strong> Durante la conquista espa√±ola, la Chakana se sincretiza con la cruz cristiana, 
            permitiendo la preservaci√≥n encubierta de la cosmovisi√≥n andina.
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-year">1780 - 1900 d.C.</div>
          <div class="timeline-desc">
            <strong>Resistencia Ind√≠gena:</strong> Tupac Amaru II y otros l√≠deres utilizan s√≠mbolos ancestrales como la Chakana 
            en sus movimientos de resistencia y reivindicaci√≥n cultural.
          </div>
        </div>
        <div class="timeline-item">
          <div class="timeline-year">1900 - Presente</div>
          <div class="timeline-desc">
            <strong>Renacimiento Cultural:</strong> La Chakana resurge como s√≠mbolo de identidad andina, 
            adoptada por movimientos indigenistas y como emblema de la filosof√≠a del Buen Vivir (Sumak Kawsay).
          </div>
        </div>
      </div>
    </section>

    <footer>
      <p>
        <strong>Chakana Ancestral</strong> es un proyecto educativo que busca preservar y compartir la sabidur√≠a andina. 
        La Chakana representa el equilibrio, la reciprocidad y la conexi√≥n profunda con la Pachamama.
      </p>
      <p>
        Este s√≠mbolo trasciende el tiempo y nos invita a reflexionar sobre nuestra relaci√≥n con la naturaleza, 
        la comunidad y el cosmos. C√≥digo abierto disponible para uso educativo y cultural.
      </p>
    </footer>
  </div>

  <script>
    // --- Sabidur√≠a ancestral de la Chakana ---
    const CHAKANA_DATA = {
      centro: {
        label: 'Centro ¬∑ Axis Mundi',
        ancestral: {
          resumen: 'N√∫cleo sagrado del cosmos andino. Punto de equilibrio donde convergen las fuerzas del universo, representando la unidad en la diversidad y el balance perfecto entre opuestos complementarios.',
          bullets: [
            'Chacana significa "escalera" en quechua, puente entre mundos',
            'Representa el principio de reciprocidad (ayni) y equilibrio',
            'Centro de ceremonias y ofrendas a la Pachamama',
            'Punto de orientaci√≥n espiritual y territorial'
          ]
        },
        innovacion: {
          resumen: 'Hub de integraci√≥n: nodo donde se conectan saberes ancestrales con tecnolog√≠as apropiadas, creando soluciones sostenibles que honran la cosmovisi√≥n andina.',
          bullets: [
            'Tecnolog√≠as apropiadas basadas en principios ancestrales',
            'Sistemas de informaci√≥n comunitaria y territorial',
            'Plataformas de intercambio de saberes tradicionales',
            'Gobernanza participativa con enfoque cultural'
          ]
        }
      },
      norte: {
        label: 'Norte ¬∑ Hanan (Lo Alto)',
        ancestral: {
          resumen: 'Direcci√≥n del Hanan Pacha, mundo de arriba asociado con las deidades, los ancestros y la sabidur√≠a. Lugar del c√≥ndor, s√≠mbolo de la visi√≥n amplia y la conexi√≥n espiritual.',
          bullets: [
            'Mundo de los Apus (esp√≠ritus de las monta√±as)',
            'Conexi√≥n con las constelaciones y ciclos astron√≥micos',
            'Sabidur√≠a ancestral y conocimiento tradicional',
            'Ceremonias de agradecimiento al cosmos'
          ]
        },
        innovacion: {
          resumen: 'Exploraci√≥n y visi√≥n estrat√©gica: investigaci√≥n participativa y desarrollo de tecnolog√≠as que amplifican la sabidur√≠a ancestral para enfrentar desaf√≠os contempor√°neos.',
          bullets: [
            'Investigaci√≥n participativa con comunidades',
            'Observatorios de cambio clim√°tico ancestral',
            'Tecnolog√≠as para preservaci√≥n cultural',
            'Sistemas de alerta temprana comunitarios'
          ]
        }
      },
      sur: {
        label: 'Sur ¬∑ Ukhu (Lo Profundo)',
        ancestral: {
          resumen: 'Direcci√≥n del Ukhu Pacha, mundo de adentro relacionado con las semillas, la fertilidad y los procesos de gestaci√≥n. Dominio de la serpiente, s√≠mbolo de la sabidur√≠a tel√∫rica.',
          bullets: [
            'Mundo de las semillas y la fertilidad',
            'Conexi√≥n con los esp√≠ritus de la tierra',
            'Conocimientos sobre agricultura y crianza',
            'Ceremonias de siembra y cosecha'
          ]
        },
        innovacion: {
          resumen: 'Ra√≠ces y sostenibilidad: sistemas que fortalecen la soberan√≠a alimentaria, la conservaci√≥n de semillas nativas y la regeneraci√≥n de ecosistemas.',
          bullets: [
            'Bancos comunitarios de semillas nativas',
            'Sistemas de agricultura regenerativa',
            'Tecnolog√≠as para conservaci√≥n de suelos',
            'Redes de intercambio de productos locales'
          ]
        }
      },
      este: {
        label: 'Este ¬∑ Antisuyu (Tierra de la Aurora)',
        ancestral: {
          resumen: 'Regi√≥n del amanecer y nuevos comienzos. El Antisuyu era la regi√≥n oriental del Tawantinsuyu, tierra de los antis, asociada con la selva, la abundancia y la renovaci√≥n.',
          bullets: [
            'Direcci√≥n del Inti (Sol) naciente',
            'Renovaci√≥n y ciclos de la vida',
            'Conexi√≥n con la biodiversidad selv√°tica',
            'Ceremonias de purificaci√≥n y renacimiento'
          ]
        },
        innovacion: {
          resumen: 'Innovaci√≥n y emprendimiento comunitario: iniciativas que nacen desde las comunidades para generar oportunidades sostenibles y preservar tradiciones.',
          bullets: [
            'Emprendimientos comunitarios sostenibles',
            'Ecoturismo vivencial y cultural',
            'Productos con valor agregado ancestral',
            'Cooperativas de comercio justo'
          ]
        }
      },
      oeste: {
        label: 'Oeste ¬∑ Kuntisuyu (Tierra del Poniente)',
        ancestral: {
          resumen: 'Regi√≥n del ocaso y la reflexi√≥n. El Kuntisuyu era la regi√≥n occidental, tierra de los kuntis, asociada con el mar, los ciclos que terminan y la sabidur√≠a que se consolida.',
          bullets: [
            'Direcci√≥n del descanso y la contemplaci√≥n',
            'Evaluaci√≥n de ciclos y cosechas',
            'Conexi√≥n con las aguas y el mar',
            'Ceremonias de cierre y agradecimiento'
          ]
        },
        innovacion: {
          resumen: 'Sistematizaci√≥n y transmisi√≥n: procesos que consolidan aprendizajes, documentan saberes y aseguran su transmisi√≥n a futuras generaciones.',
          bullets: [
            'Documentaci√≥n de saberes ancestrales',
            'Sistemas de educaci√≥n intercultural',
            'Archivos digitales comunitarios',
            'Metodolog√≠as de transmisi√≥n cultural'
          ]
        }
      }
    };

    // --- Estado de la aplicaci√≥n ---
    const $ = (q, root=document) => root.querySelector(q);
    const $$ = (q, root=document) => Array.from(root.querySelectorAll(q));

    const chakanaApp = {
      mode: 'ancestral',
      selected: 'centro'
    };

    // Funci√≥n para renderizar informaci√≥n de las regiones
    function renderRegionInfo(){
      const region = CHAKANA_DATA[chakanaApp.selected];
      $('#info-title').textContent = region.label;
      $('#modeTag').textContent = `Capa: ${chakanaApp.mode === 'ancestral' ? 'Ancestral' : 'Innovaci√≥n'}`;
      $('#modeLabel').textContent = chakanaApp.mode === 'ancestral' ? 'Ancestralidad' : 'Innovaci√≥n';

      const content = region[chakanaApp.mode];
      $('#info-summary').textContent = content.resumen;
      
      const ul = $('#info-bullets');
      ul.innerHTML = '';
      content.bullets.forEach(bullet => {
        const li = document.createElement('li');
        li.textContent = bullet;
        ul.appendChild(li);
      });

      // Actualizar visualizaci√≥n de la regi√≥n activa
      updateActiveRegion();
      
      // Actualizar URL para compartir estado
      updateURL();
    }

    // Funci√≥n para actualizar la regi√≥n activa visualmente
    function updateActiveRegion(){
      // Remover clases activas anteriores
      $$('.active-region').forEach(el => el.classList.remove('active-region'));
      $$('.label.highlight').forEach(el => el.classList.remove('highlight'));
      
      // Agregar clase activa a la regi√≥n seleccionada
      const regionMap = {
        centro: '#r-centro', 
        norte: '#r-norte', 
        sur: '#r-sur', 
        este: '#r-este', 
        oeste: '#r-oeste'
      };
      
      const activeElement = $(regionMap[chakanaApp.selected]);
      if(activeElement) {
        activeElement.classList.add('active-region');
      }

      // Resaltar etiquetas correspondientes
      const labelSelectors = {
        centro: '',
        norte: '#layer-dirs text:first-child, #layer-niveles text:first-child',
        sur: '#layer-dirs text:nth-child(3), #layer-niveles text:nth-child(3)',
        este: '#layer-dirs text:nth-child(2), #layer-suyus text:first-child',
        oeste: '#layer-dirs text:nth-child(4), #layer-suyus text:nth-child(4)'
      };
      
      if(labelSelectors[chakanaApp.selected]) {
        $$(labelSelectors[chakanaApp.selected]).forEach(label => {
          label.classList.add('highlight');
        });
      }
    }

    // Funci√≥n para cambiar modo
    function cambiarModo(nuevoModo){
      chakanaApp.mode = nuevoModo;
      document.body.setAttribute('data-mode', nuevoModo === 'ancestral' ? 'ancestral' : 'innovacion');
      renderRegionInfo();
    }

    // Funci√≥n para actualizar URL
    function updateURL(){
      location.hash = `${chakanaApp.selected}-${chakanaApp.mode}`;
    }

    // Event listeners para regiones interactivas
    $$('#chakana [data-key]').forEach(elemento => {
      // Click
      elemento.addEventListener('click', () => {
        chakanaApp.selected = elemento.dataset.key;
        renderRegionInfo();
      });
      
      // Teclado (accesibilidad)
      elemento.addEventListener('keydown', (evento) => {
        if(evento.key === 'Enter' || evento.key === ' ') {
          evento.preventDefault();
          chakanaApp.selected = elemento.dataset.key;
          renderRegionInfo();
        }
      });

      // Hover effects para mejor UX
      elemento.addEventListener('mouseenter', () => {
        elemento.style.transform = 'scale(1.02)';
      });
      
      elemento.addEventListener('mouseleave', () => {
        elemento.style.transform = 'scale(1)';
      });
    });

    // Event listener para bot√≥n de modo
    $('#modeBtn').addEventListener('click', () => {
      const nuevoModo = chakanaApp.mode === 'ancestral' ? 'innovacion' : 'ancestral';
      cambiarModo(nuevoModo);
    });

    // Event listeners para capas visuales
    $$('.legend .pill').forEach(boton => {
      boton.addEventListener('click', () => {
        const capa = boton.dataset.layer;
        const mapaCapa = {
          dirs: '#layer-dirs', 
          niveles: '#layer-niveles', 
          suyus: '#layer-suyus'
        };
        
        const elementoCapa = $(mapaCapa[capa]);
        if(elementoCapa) {
          const estaActivo = boton.classList.toggle('active');
          boton.setAttribute('aria-pressed', estaActivo ? 'true' : 'false');
          elementoCapa.style.opacity = estaActivo ? 1 : 0;
          elementoCapa.style.transition = 'opacity 0.3s ease';
        }
      });
    });

    // Inicializaci√≥n desde URL hash
    function inicializarDesdeURL(){
      const [region, modo] = (location.hash.replace('#','') || '').split('-');
      
      if(CHAKANA_DATA[region]) {
        chakanaApp.selected = region;
      }
      
      if(modo === 'ancestral' || modo === 'innovacion') {
        chakanaApp.mode = modo;
      }
      
      document.body.setAttribute('data-mode', chakanaApp.mode);
      renderRegionInfo();
    }

    // Inicializar aplicaci√≥n
    document.addEventListener('DOMContentLoaded', inicializarDesdeURL);
    
    // Manejar cambios en el hash de la URL
    window.addEventListener('hashchange', inicializarDesdeURL);
  </script>
  
  <!-- UI helpers: tooltip, toast y modal -->
  <div id="tooltip" class="tooltip" role="tooltip" aria-hidden="true" style="display:none">
    <div class="t-title"></div>
    <div class="t-desc"></div>
  </div>
  <div id="toast" class="toast" role="status" aria-live="polite" style="display:none"></div>
  <div id="helpBackdrop" class="modal-backdrop"></div>
  <div id="helpModal" class="modal" role="dialog" aria-modal="true" aria-labelledby="helpTitle" aria-hidden="true">
    <div class="box">
      <h3 id="helpTitle">Ayuda ¬∑ C√≥mo interactuar con la Chakana</h3>
      <p>‚Ä¢ Haz clic o usa Enter/Espacio sobre el centro o los brazos para ver su significado.</p>
      <p>‚Ä¢ Usa los botones de ‚ÄúCapas‚Äù para mostrar direcciones, tres mundos y Tawantinsuyu.</p>
      <p>‚Ä¢ Teclas de flecha: Navega Norte/Sur/Este/Oeste. Tecla C: Centro.</p>
      <p>‚Ä¢ ‚ÄúRecorrido‚Äù alterna un paseo autom√°tico por las regiones.</p>
      <div class="actions">
        <button id="closeHelp" class="btn">Cerrar</button>
      </div>
    </div>
  </div>
  
  <script>
    // --- Extras de UX: recorrido, copiar estado, tooltips, navegaci√≥n ---
    let tourTimer = null;

    function startTour(){
      const orden = ['centro','norte','este','sur','oeste'];
      let i = orden.indexOf(chakanaApp.selected);
      if(i < 0) i = 0;
      tourTimer = setInterval(() => {
        i = (i + 1) % orden.length;
        chakanaApp.selected = orden[i];
        renderRegionInfo();
        const selMap = {centro:'#r-centro', norte:'#r-norte', este:'#r-este', sur:'#r-sur', oeste:'#r-oeste'};
        const el = document.querySelector(selMap[chakanaApp.selected]);
        el && el.focus();
      }, 3000);
      document.getElementById('tourBtn').setAttribute('aria-pressed','true');
    }

    function stopTour(){
      if(tourTimer){ clearInterval(tourTimer); tourTimer = null; }
      document.getElementById('tourBtn').setAttribute('aria-pressed','false');
    }

    // Bot√≥n de recorrido
    document.getElementById('tourBtn').addEventListener('click', () => {
      if(tourTimer) stopTour(); else startTour();
    });

    // Bot√≥n copiar estado
    document.getElementById('copyBtn').addEventListener('click', async () => {
      updateURL();
      try{
        await navigator.clipboard.writeText(location.href);
        showToast('Enlace del estado copiado');
      }catch(e){ showToast('No se pudo copiar. Copia manualmente la URL.'); }
    });

    // Ayuda (modal)
    const helpBtn = document.getElementById('helpBtn');
    const helpBackdrop = document.getElementById('helpBackdrop');
    const helpModal = document.getElementById('helpModal');
    const closeHelp = document.getElementById('closeHelp');
    function openHelp(){ helpBackdrop.style.display='block'; helpModal.style.display='grid'; helpModal.setAttribute('aria-hidden','false'); }
    function closeHelpFn(){ helpBackdrop.style.display='none'; helpModal.style.display='none'; helpModal.setAttribute('aria-hidden','true'); }
    helpBtn.addEventListener('click', openHelp);
    closeHelp.addEventListener('click', closeHelpFn);
    helpBackdrop.addEventListener('click', closeHelpFn);

    // Tooltip
    const tooltip = document.getElementById('tooltip');
    function showTooltip(x,y,title,desc){
      tooltip.style.display='block';
      tooltip.style.left = x + 'px';
      tooltip.style.top = y + 'px';
      tooltip.querySelector('.t-title').textContent = title;
      tooltip.querySelector('.t-desc').textContent = desc;
      tooltip.classList.add('visible');
      tooltip.setAttribute('aria-hidden','false');
    }
    function hideTooltip(){
      tooltip.classList.remove('visible');
      tooltip.setAttribute('aria-hidden','true');
      tooltip.style.display='none';
    }

    // Toast
    const toast = document.getElementById('toast');
    function showToast(msg){
      toast.textContent = msg;
      toast.style.display='block';
      toast.classList.add('show');
      setTimeout(() => { toast.classList.remove('show'); toast.style.display='none'; }, 1800);
    }

    // Enriquecer regiones con tooltip y navegaci√≥n
    $$('#chakana [data-key]').forEach(el => {
      const key = el.dataset.key;
      el.addEventListener('mousemove', (ev) => {
        const node = CHAKANA_DATA[key];
        const desc = (node?.[chakanaApp.mode]?.resumen || '').slice(0, 140);
        showTooltip(ev.clientX, ev.clientY, node?.label || key, desc);
      });
      el.addEventListener('mouseleave', hideTooltip);
      el.addEventListener('focus', (ev)=>{
        const node = CHAKANA_DATA[key];
        const rect = el.getBoundingClientRect();
        showTooltip(rect.left + rect.width/2, rect.top, node?.label || key, (node?.[chakanaApp.mode]?.resumen || '').slice(0,140));
      });
      el.addEventListener('blur', hideTooltip);
    });

    // Navegaci√≥n con flechas
    window.addEventListener('keydown', (ev) => {
      const mapNext = {
        ArrowUp:   'norte',
        ArrowDown: 'sur',
        ArrowLeft: 'oeste',
        ArrowRight:'este',
        c: 'centro', C: 'centro'
      };
      if(mapNext[ev.key]){
        ev.preventDefault();
        chakanaApp.selected = mapNext[ev.key];
        renderRegionInfo();
        const selMap = {centro:'#r-centro', norte:'#r-norte', este:'#r-este', sur:'#r-sur', oeste:'#r-oeste'};
        const el = document.querySelector(selMap[chakanaApp.selected]);
        el && el.focus();
      }
    });
  </script>
</body>
</html>
